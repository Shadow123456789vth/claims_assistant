"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _react = _interopRequireDefault(require("react"));

var _react2 = require("@testing-library/react");

var _userEvent = _interopRequireDefault(require("@testing-library/user-event"));

var _PasswordInput = _interopRequireDefault(require("./PasswordInput"));

describe("Password input component tests", function () {
  test("Password input renders with label", function () {
    var _render = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_PasswordInput["default"], {
      label: "Password input label"
    })),
        getByText = _render.getByText;

    expect(getByText("Password input label")).toBeTruthy();
  });
  test("Password input renders with helper text", function () {
    var _render2 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_PasswordInput["default"], {
      helperText: "Helper text"
    })),
        getByText = _render2.getByText;

    expect(getByText("Helper text")).toBeTruthy();
  });
  test("Password input renders error", function () {
    var _render3 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_PasswordInput["default"], {
      error: "Error message."
    })),
        getByText = _render3.getByText;

    expect(getByText("Error message.")).toBeTruthy();
  });
  test("onChange function is called correctly", function () {
    var onChange = jest.fn();

    var _render4 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_PasswordInput["default"], {
      label: "Password input",
      onChange: onChange
    })),
        getByRole = _render4.getByRole;

    var passwordInput = getByRole("textbox");

    _userEvent["default"].type(passwordInput, "Pa$$w0rd");

    expect(onChange).toHaveBeenCalledWith({
      value: "P"
    });
    expect(passwordInput.value).toBe("Pa$$w0rd");
  });
  test("onBlur function is called correctly", function () {
    var onBlur = jest.fn();

    var _render5 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_PasswordInput["default"], {
      label: "Password input",
      onBlur: onBlur
    })),
        getByRole = _render5.getByRole;

    var passwordInput = getByRole("textbox");

    _userEvent["default"].type(passwordInput, "Pa$$w0rd");

    _react2.fireEvent.blur(passwordInput);

    expect(onBlur).toHaveBeenCalledWith({
      value: "Pa$$w0rd"
    });
    expect(passwordInput.value).toBe("Pa$$w0rd");
  });
  test("Clear password input value", function () {
    var _render6 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_PasswordInput["default"], {
      label: "Password input",
      clearable: true
    })),
        getAllByRole = _render6.getAllByRole,
        getByRole = _render6.getByRole;

    var passwordInput = getByRole("textbox");

    _userEvent["default"].type(passwordInput, "Pa$$w0rd");

    expect(passwordInput.value).toBe("Pa$$w0rd");
    var clearButton = getAllByRole("button")[0];

    _userEvent["default"].click(clearButton);

    expect(passwordInput.value).toBe("");
  });
  test("Non clearable password input has no clear icon", function () {
    var _render7 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_PasswordInput["default"], {
      label: "Password input"
    })),
        getAllByRole = _render7.getAllByRole,
        getByRole = _render7.getByRole;

    var passwordInput = getByRole("textbox");

    _userEvent["default"].type(passwordInput, "Pa$$w0rd");

    expect(passwordInput.value).toBe("Pa$$w0rd");
    var buttons = getAllByRole("button");
    expect(buttons.length).toBe(1);
  });
  test("Show/hide password input button works correctly", function () {
    var _render8 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_PasswordInput["default"], {
      label: "Password input",
      clearable: true
    })),
        getAllByRole = _render8.getAllByRole,
        getByRole = _render8.getByRole;

    var passwordInput = getByRole("textbox");

    _userEvent["default"].type(passwordInput, "Pa$$w0rd");

    expect(passwordInput.value).toBe("Pa$$w0rd");
    expect(passwordInput.type).toBe("password");
    var showButton = getAllByRole("button")[1];

    _userEvent["default"].click(showButton);

    expect(passwordInput.type).toBe("text");
  });
  test("Password tooltip is correct", /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
    var _render9, getAllByRole, getByTitle, queryByTitle, showButton;

    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _render9 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_PasswordInput["default"], {
              label: "Password input",
              clearable: true,
              value: "Password"
            })), getAllByRole = _render9.getAllByRole, getByTitle = _render9.getByTitle, queryByTitle = _render9.queryByTitle;
            showButton = getAllByRole("button")[1];

            _userEvent["default"].hover(showButton);

            expect(getByTitle("Show password")).toBeTruthy();

            _userEvent["default"].unhover(showButton);

            expect(queryByTitle("Hide password")).toBeFalsy();

          case 6:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  })));
  test("Password input has correct accesibility attributes", function () {
    var _render10 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_PasswordInput["default"], {
      label: "Password input"
    })),
        getByRole = _render10.getByRole;

    var passwordInput = getByRole("textbox");
    expect(passwordInput.getAttribute("aria-autocomplete")).toBeNull();
    expect(passwordInput.getAttribute("aria-controls")).toBeNull();
    expect(passwordInput.getAttribute("aria-expanded")).toBeNull();
    var showButton = getByRole("button");
    expect(showButton.getAttribute("aria-label")).toBe("Show password");

    _userEvent["default"].click(showButton);

    expect(showButton.getAttribute("aria-label")).toBe("Hide password");
  });
});