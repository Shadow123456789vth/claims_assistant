"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _react = _interopRequireDefault(require("react"));

var _react2 = require("@testing-library/react");

var _userEvent = _interopRequireDefault(require("@testing-library/user-event"));

var _Slider = _interopRequireDefault(require("./Slider"));

describe("Slider component tests", function () {
  test("Slider renders with correct text and label id", function () {
    var _render = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Slider["default"], {
      label: "label",
      minValue: 0,
      maxValue: 100,
      showLimitsValues: true
    })),
        getByText = _render.getByText,
        getByRole = _render.getByRole;

    expect(getByText("0")).toBeTruthy();
    expect(getByText("100")).toBeTruthy();
    var sliderId = getByText("label").getAttribute("id");
    expect(getByRole("slider").getAttribute("aria-labelledby")).toBe(sliderId);
    expect(getByRole("slider").getAttribute("aria-orientation")).toBe("horizontal");
  });
  test("Slider renders with correct initial value when it is uncontrolled", function () {
    var _render2 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Slider["default"], {
      defaultValue: 30,
      minValue: 0,
      maxValue: 100,
      showLimitsValues: true,
      showInput: true
    })),
        getByRole = _render2.getByRole;

    var slider = getByRole("slider");
    var input = getByRole("textbox");
    expect(slider.getAttribute("aria-valuenow")).toBe("30");
    expect(input.value).toBe("30");
  });
  test("Slider correct limit values", function () {
    var _render3 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Slider["default"], {
      defaultValue: 125,
      minValue: 30,
      maxValue: 125,
      showLimitsValues: true
    })),
        getByRole = _render3.getByRole,
        getByText = _render3.getByText;

    var slider = getByRole("slider");
    expect(slider.getAttribute("aria-valuemin")).toBe("30");
    expect(slider.getAttribute("aria-valuemax")).toBe("125");

    _userEvent["default"].tab();

    _react2.fireEvent.keyDown(slider, {
      key: "ArrowRight",
      code: "ArrowRight",
      keyCode: 39,
      charCode: 39
    });

    expect(slider.getAttribute("aria-valuenow")).toBe("125");
    expect(getByText("30")).toBeTruthy();
    expect(getByText("125")).toBeTruthy();
  });
  test("Calls correct function onChange in controlled slider", function () {
    var onChange = jest.fn();

    var _render4 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Slider["default"], {
      minValue: 0,
      maxValue: 100,
      onChange: onChange,
      showLimitsValues: true,
      value: 13,
      showInput: true
    })),
        getByRole = _render4.getByRole;

    expect(getByRole("slider").getAttribute("aria-valuenow")).toBe("13");
    expect(getByRole("textbox").value).toBe("13");
    (0, _react2.act)(function () {
      _react2.fireEvent.change(getByRole("textbox"), {
        target: {
          value: 25
        }
      });
    });
    expect(onChange).toHaveBeenCalledWith(25);
    expect(getByRole("slider").getAttribute("aria-valuenow")).toBe("13");
    expect(getByRole("textbox").value).toBe("13");
  });
  test("Calls correct function onChange in uncontrolled slider", function () {
    var onChange = jest.fn();

    var _render5 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Slider["default"], {
      minValue: 0,
      maxValue: 100,
      onChange: onChange,
      showLimitsValues: true,
      showInput: true
    })),
        getByRole = _render5.getByRole;

    (0, _react2.act)(function () {
      _react2.fireEvent.change(getByRole("textbox"), {
        target: {
          value: 25
        }
      });
    });
    expect(onChange).toHaveBeenCalledWith(25);
    expect(getByRole("slider").getAttribute("aria-valuenow")).toBe("25");
    expect(getByRole("textbox").value).toBe("25");
  });
  test("Disabled slider have disabled input and slider", function () {
    var onChange = jest.fn();

    var _render6 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Slider["default"], {
      minValue: 0,
      maxValue: 100,
      onChange: onChange,
      showLimitsValues: true,
      disabled: true,
      showInput: true,
      value: 13
    })),
        getByRole = _render6.getByRole;

    (0, _react2.act)(function () {
      _react2.fireEvent.change(getByRole("textbox"), {
        target: {
          value: 25
        }
      });
    });
    expect(getByRole("textbox").hasAttribute("disabled")).toBeTruthy();
    expect(getByRole("textbox").value).toBe("13");
    expect(getByRole("slider").hasAttribute("disabled")).toBeTruthy();
  });
  test("Calls correct function onDragEnd when it is uncontrolled", function () {
    var onDragEnd = jest.fn();

    var _render7 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Slider["default"], {
      minValue: 0,
      maxValue: 150,
      onDragEnd: onDragEnd,
      showInput: true
    })),
        getByRole = _render7.getByRole;

    var slider = getByRole("slider");
    (0, _react2.act)(function () {
      _react2.fireEvent.mouseDown(slider);
    });
    (0, _react2.act)(function () {
      _react2.fireEvent.mouseUp(slider, {
        target: {
          value: 120
        }
      });
    });
    expect(onDragEnd).toHaveBeenCalledWith("120");
  });
  test("Calls correct function onDragEnd when it is controlled", function () {
    var onDragEnd = jest.fn();

    var _render8 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Slider["default"], {
      minValue: 0,
      maxValue: 150,
      value: 50,
      onDragEnd: onDragEnd,
      showInput: true
    })),
        getByRole = _render8.getByRole;

    var slider = getByRole("slider");
    (0, _react2.act)(function () {
      _react2.fireEvent.mouseDown(slider);
    });
    (0, _react2.act)(function () {
      _react2.fireEvent.mouseUp(slider, {
        target: {
          value: 120
        }
      });
    });
    expect(onDragEnd).toHaveBeenCalledWith("120");
    expect(slider.getAttribute("aria-valuenow")).toBe("50");
  });
  test("Calls correct function labelFormatCallback", function () {
    var labelFormatCallback = jest.fn(function (x) {
      return "".concat(x, "$");
    });

    var _render9 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Slider["default"], {
      minValue: 0,
      maxValue: 100,
      showLimitsValues: true,
      showInput: true,
      value: 25,
      labelFormatCallback: labelFormatCallback
    })),
        getByText = _render9.getByText;

    expect(getByText("0$")).toBeTruthy();
    expect(getByText("100$")).toBeTruthy();
    expect(labelFormatCallback).toHaveBeenCalledTimes(2);
  });
  test("Change value correctly to 0 from external function", function () {
    var onChange = jest.fn();

    var _render10 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Slider["default"], {
      minValue: 0,
      maxValue: 100,
      onChange: onChange,
      showLimitsValues: true,
      value: 13,
      showInput: true
    })),
        rerender = _render10.rerender,
        getByRole = _render10.getByRole;

    var slider = getByRole("slider");

    _userEvent["default"].tab();

    _react2.fireEvent.keyDown(slider, {
      key: "ArrowRight",
      code: "ArrowRight",
      keyCode: 39,
      charCode: 39
    });

    rerender( /*#__PURE__*/_react["default"].createElement(_Slider["default"], {
      minValue: 0,
      maxValue: 100,
      onChange: onChange,
      showLimitsValues: true,
      value: 0,
      showInput: true
    }));
    expect(slider.getAttribute("aria-valuenow")).toBe("0");
  });
});