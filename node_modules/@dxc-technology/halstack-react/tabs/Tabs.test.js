"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _react = _interopRequireDefault(require("react"));

var _react2 = require("@testing-library/react");

var _Tabs = _interopRequireDefault(require("./Tabs"));

var sampleTabs = [{
  label: "Tab-1"
}, {
  label: "Tab-2"
}, {
  label: "Tab-3"
}];
var sampleTabsWithBadge = [{
  label: "Tab-1",
  notificationNumber: "10"
}, {
  label: "Tab-2",
  notificationNumber: "20"
}, {
  label: "Tab-3",
  notificationNumber: "101"
}];
var sampleTabsMiddleDisabled = [{
  label: "Tab-1"
}, {
  label: "Tab-2",
  isDisabled: true
}, {
  label: "Tab-3"
}];
var sampleTabsLastTabNonDisabled = [{
  label: "Tab-1",
  isDisabled: true
}, {
  label: "Tab-2",
  isDisabled: true
}, {
  label: "Tab-3"
}];
describe("Tabs component tests", function () {
  test("Tabs render with correct labels", function () {
    var _render = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Tabs["default"], {
      tabs: sampleTabs
    })),
        getByText = _render.getByText,
        getAllByRole = _render.getAllByRole;

    var tabs = getAllByRole("tab");
    expect(getByText("Tab-1")).toBeTruthy();
    expect(getByText("Tab-2")).toBeTruthy();
    expect(getByText("Tab-3")).toBeTruthy();
    expect(tabs[0].getAttribute("aria-selected")).toBe("true");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("false");
  });
  test("Tabs render with correct labels and badges", function () {
    var _render2 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Tabs["default"], {
      tabs: sampleTabsWithBadge
    })),
        getByText = _render2.getByText;

    expect(getByText("10")).toBeTruthy();
    expect(getByText("20")).toBeTruthy();
    expect(getByText("+99")).toBeTruthy();
  });
  test("Tabs render with an initially active tab", function () {
    var _render3 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Tabs["default"], {
      defaultActiveTabIndex: 2,
      tabs: sampleTabsWithBadge
    })),
        getAllByRole = _render3.getAllByRole;

    var tabs = getAllByRole("tab");
    expect(tabs[0].getAttribute("aria-selected")).toBe("false");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("true");
  });
  test("Tabs render with correct icons", function () {
    var _render4 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Tabs["default"], {
      tabs: [{
        label: "Tab-1",
        icon: "/testIcon1.png"
      }, {
        label: "Tab-2",
        icon: "/testIcon2.png"
      }, {
        label: "Tab-3",
        icon: "/testIcon3.png"
      }]
    })),
        getAllByRole = _render4.getAllByRole;

    expect(getAllByRole("img")[0].getAttribute("src")).toBe("/testIcon1.png");
    expect(getAllByRole("img")[1].getAttribute("src")).toBe("/testIcon2.png");
    expect(getAllByRole("img")[2].getAttribute("src")).toBe("/testIcon3.png");
  });
  test("Tabs render with disabled tab", function () {
    var _render5 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Tabs["default"], {
      tabs: [{
        label: "Tab-1",
        isDisabled: true
      }, {
        label: "Tab-2"
      }]
    })),
        getAllByRole = _render5.getAllByRole;

    expect(getAllByRole("tab")[0].hasAttribute("disabled")).toBeTruthy();
    expect(getAllByRole("tab")[1].hasAttribute("disabled")).toBeFalsy();
  });
  test("Uncontrolled tabs", function () {
    var onTabClick = jest.fn();

    var _render6 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Tabs["default"], {
      tabs: sampleTabs,
      onTabClick: onTabClick
    })),
        getByText = _render6.getByText,
        getAllByRole = _render6.getAllByRole;

    var tabs = getAllByRole("tab");
    var tab1 = getByText("Tab-1");
    var tab2 = getByText("Tab-2");

    _react2.fireEvent.click(tab2);

    expect(onTabClick).toHaveBeenCalledWith(1);
    expect(tabs[0].getAttribute("aria-selected")).toBe("false");
    expect(tabs[1].getAttribute("aria-selected")).toBe("true");
    expect(tabs[2].getAttribute("aria-selected")).toBe("false");

    _react2.fireEvent.click(tab1);

    expect(onTabClick).toHaveBeenCalledWith(0);
    expect(tabs[0].getAttribute("aria-selected")).toBe("true");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("false");
  });
  test("Controlled tabs", function () {
    var onTabClick = jest.fn();

    var _render7 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Tabs["default"], {
      tabs: sampleTabs,
      onTabClick: onTabClick,
      activeTabIndex: 0
    })),
        getByText = _render7.getByText,
        getAllByRole = _render7.getAllByRole;

    var tabs = getAllByRole("tab");

    _react2.fireEvent.click(tabs[1]);

    expect(onTabClick).toHaveBeenCalledWith(1);
    expect(tabs[0].getAttribute("aria-selected")).toBe("true");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("false");

    _react2.fireEvent.click(tabs[2]);

    expect(onTabClick).toHaveBeenCalledWith(2);
    expect(tabs[0].getAttribute("aria-selected")).toBe("true");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("false");
  });
  test("Uncontrolled tabs should have focus in the first non-disabled tab", function () {
    var onTabClick = jest.fn();

    var _render8 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Tabs["default"], {
      tabs: sampleTabsLastTabNonDisabled,
      onTabClick: onTabClick
    })),
        getAllByRole = _render8.getAllByRole;

    var tabs = getAllByRole("tab");
    expect(tabs[0].hasAttribute("disabled")).toBeTruthy();
    expect(tabs[1].hasAttribute("disabled")).toBeTruthy();
    expect(tabs[2].hasAttribute("disabled")).toBeFalsy();
    expect(tabs[0].getAttribute("aria-selected")).toBe("false");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("true");
  });
  test("Controlled tabs with active index in disabled tab should not change focus to the first available tab", function () {
    var onTabClick = jest.fn();

    var _render9 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Tabs["default"], {
      tabs: sampleTabsLastTabNonDisabled,
      onTabClick: onTabClick,
      activeTabIndex: 0
    })),
        getAllByRole = _render9.getAllByRole;

    var tabs = getAllByRole("tab");
    expect(tabs[0].getAttribute("aria-selected")).toBe("true");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("false");
    expect(tabs[0].hasAttribute("disabled")).toBeTruthy();
    expect(tabs[1].hasAttribute("disabled")).toBeTruthy();
    expect(tabs[2].hasAttribute("disabled")).toBeFalsy();

    _react2.fireEvent.click(tabs[2]);

    expect(onTabClick).toHaveBeenCalledWith(2);
    expect(tabs[0].getAttribute("aria-selected")).toBe("true");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("false");
    expect(tabs[0].hasAttribute("disabled")).toBeTruthy();
    expect(tabs[1].hasAttribute("disabled")).toBeTruthy();
    expect(tabs[2].hasAttribute("disabled")).toBeFalsy();
  });
  test("Select tabs with keyboard event arrows", function () {
    var onTabClick = jest.fn();

    var _render10 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Tabs["default"], {
      tabs: sampleTabs,
      onTabClick: onTabClick
    })),
        getByText = _render10.getByText,
        getByRole = _render10.getByRole,
        getAllByRole = _render10.getAllByRole;

    var tabList = getByRole("tablist");
    var tab1 = getByText("Tab-1");
    var tabs = getAllByRole("tab");

    _react2.fireEvent.click(tab1);

    expect(tabs[0].getAttribute("aria-selected")).toBe("true");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("false");
    expect(onTabClick).toHaveBeenCalledWith(0);

    _react2.fireEvent.keyDown(tabList, {
      key: "ArrowRight"
    });

    _react2.fireEvent.keyDown(tabList, {
      key: "Enter"
    });

    expect(tabs[0].getAttribute("aria-selected")).toBe("false");
    expect(tabs[1].getAttribute("aria-selected")).toBe("true");
    expect(tabs[2].getAttribute("aria-selected")).toBe("false");
    expect(onTabClick).toHaveBeenCalledWith(1);

    _react2.fireEvent.keyDown(tabList, {
      key: "ArrowRight"
    });

    _react2.fireEvent.keyDown(tabList, {
      key: "Enter"
    });

    expect(tabs[0].getAttribute("aria-selected")).toBe("false");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("true");
    expect(onTabClick).toHaveBeenCalledWith(2);

    _react2.fireEvent.keyDown(tabList, {
      key: "ArrowLeft"
    });

    _react2.fireEvent.keyDown(tabList, {
      key: "Enter"
    });

    expect(tabs[0].getAttribute("aria-selected")).toBe("false");
    expect(tabs[1].getAttribute("aria-selected")).toBe("true");
    expect(tabs[2].getAttribute("aria-selected")).toBe("false");
    expect(onTabClick).toHaveBeenCalledWith(1);

    _react2.fireEvent.keyDown(tabList, {
      key: "ArrowLeft"
    });

    _react2.fireEvent.keyDown(tabList, {
      key: "Enter"
    });

    expect(tabs[0].getAttribute("aria-selected")).toBe("true");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("false");
    expect(onTabClick).toHaveBeenCalledWith(0);

    _react2.fireEvent.keyDown(tabList, {
      key: "ArrowLeft"
    });

    _react2.fireEvent.keyDown(tabList, {
      key: "Enter"
    });

    expect(tabs[0].getAttribute("aria-selected")).toBe("false");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("true");
    expect(onTabClick).toHaveBeenCalledWith(2);

    _react2.fireEvent.keyDown(tabList, {
      key: "ArrowRight"
    });

    _react2.fireEvent.keyDown(tabList, {
      key: "Enter"
    });

    expect(tabs[0].getAttribute("aria-selected")).toBe("true");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("false");
    expect(onTabClick).toHaveBeenCalledWith(0);
  });
  test("Skip disabled tab with keyboard event arrows", function () {
    var onTabClick = jest.fn();

    var _render11 = (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_Tabs["default"], {
      tabs: sampleTabsMiddleDisabled,
      onTabClick: onTabClick
    })),
        getByText = _render11.getByText,
        getByRole = _render11.getByRole,
        getAllByRole = _render11.getAllByRole;

    var tabList = getByRole("tablist");
    var tab1 = getByText("Tab-1");
    var tabs = getAllByRole("tab");

    _react2.fireEvent.click(tab1);

    expect(tabs[0].getAttribute("aria-selected")).toBe("true");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("false");
    expect(onTabClick).toHaveBeenCalledWith(0);

    _react2.fireEvent.keyDown(tabList, {
      key: "ArrowRight"
    });

    _react2.fireEvent.keyDown(tabList, {
      key: " "
    });

    expect(tabs[0].getAttribute("aria-selected")).toBe("false");
    expect(tabs[1].getAttribute("aria-selected")).toBe("false");
    expect(tabs[2].getAttribute("aria-selected")).toBe("true");
    expect(onTabClick).toHaveBeenCalledWith(2);
  });
});